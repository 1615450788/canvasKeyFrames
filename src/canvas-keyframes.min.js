!function(){"use strict";function a(a,c,d,e){if(!a||!d)throw new Error("el和imgs是必填参数");if("array"!==c&&"sprite"!==c)throw new Error('只支持"array"和"sprite"模式');this.el=a,this.mode=c,this.imgs=d,this.imgsLen=null,this.canvas=null,this.ctx=null,this.timer=null,this.state="stop",this.infinite=1e9,this.ispause=!1,this.plusNum=0,this.plusCount=0,this.count=0;var f={cover:0,fps:24,loop:"infinite",ratio:1};this.options=e||f,this.options.cover=e.cover||f.cover,this.options.fps=e.fps||f.fps,this.options.loop=e.loop||f.loop,this.options.ratio=e.ratio||f.ratio,this.recordFrom=0,this.recordTo=null,this.recordInf=this.options.loop,b(this)}function b(a){c(a),"array"===a.mode?a.imgsLen=a.imgs.length:"sprite"===a.mode&&(a.wt=a.imgs.width/a.options._iw,a.ht=a.imgs.height/a.options._ih,a.imgsLen=a.options.framesCount?a.options.framesCount:Math.round(2*a.imgs.width/(a.canvas.width*a.options.ratio))),a.recordTo=a.imgsLen-1,e(a)}function c(a){var b=document.createElement("canvas");b.width=2*a.options.width||a.el.clientWidth,b.height=2*a.options.height||a.el.clientHeight,b.style.display="block",b.style.width="100%",b.style.height="100%",a.ctx=b.getContext("2d"),a.el.appendChild(b),a.canvas=b}function d(a,b){var c,d,e;if(a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),"array"===a.mode)0!==a.imgs[b].width&&a.ctx.drawImage(a.imgs[b],0,0,a.canvas.width,a.canvas.height);else{if("sprite"!==a.mode)throw new Error("没有匹配的模式");c=a.imgs.width/a.imgsLen,a.options.framesCount?(d=1==a.wt?0:Math.floor(b/a.wt)<=0?b:1==b/a.wt?0:b-a.wt*Math.floor(b/a.wt),e=1==a.ht?0:Math.floor(b/a.ht)<=0?0:Math.floor(b/a.ht),a.ctx.drawImage(a.imgs,a.options._iw*d,a.options._ih*e,a.options._iw,a.options._iw,0,0,a.canvas.width,a.canvas.height)):(c=a.imgs.width/a.imgsLen,a.ctx.drawImage(a.imgs,c*b,0,c,a.imgs.height,0,0,a.canvas.width,a.canvas.height))}}function e(a){d(a,a.options.cover)}a.prototype={constructor:a,"goto":function(a){d(this,a),this.count=a},next:function(){var a=(this.count+1+this.imgsLen-1)%(this.imgsLen-1);this.goto(a)},prev:function(){var a=(this.count-1+this.imgsLen-1)%(this.imgsLen-1);this.goto(a)},fromTo:function(a,b,c,d){var f,g,e=this;clearInterval(this.timer),f=a,g=function(){return e.ispause?void 0:e.plusNum<=e.plusCount?(clearInterval(e.timer),e.timer=null,e.plusNum=0,e.plusCount=0,e.state="stop",d&&d(),void 0):(f>b&&(f=a),e.goto(f),f++,e.plusCount++,void 0)},this.plusCount=0,this.state="play",c=c&&"infinite"!==c?c:this.infinite,this.plusNum=(b-a+1)*c,this.ispause=!1,this.recordFrom=a,this.recordTo=b,this.recordInf=c,g(),this.timer=setInterval(g,1e3/this.options.fps)},toFrom:function(a,b,c,d){var f,g,e=this;clearInterval(this.timer),f=a,g=function(){return e.ispause?void 0:e.plusNum<=e.plusCount?(clearInterval(e.timer),e.timer=null,e.plusNum=0,e.plusCount=0,e.state="stop",d&&d(),void 0):(b>f&&(f=a),e.goto(f),f--,e.plusCount++,void 0)},this.plusCount=0,this.state="play",c=c&&"infinite"!==c?c:this.infinite,this.plusNum=(a-b+1)*c,this.ispause=!1,this.recordFrom=b,this.recordTo=a,this.recordInf=c,g(),this.timer=setInterval(g,1e3/this.options.fps)},repeatplay:function(a,b,c,d){var g,h,e=this,f=0;c=c&&"infinite"!==c?c:this.infinite,g=function(){f++,f===c?d&&d():e.fromTo(a,b,2,d)},h=function(){e.toFrom(b,a,1,g)},this.fromTo(a,b,1,h)},from:function(a,b,c){var d=this.imgsLen-1;this.fromTo(a,d,b,c)},to:function(a,b,c){var d=0;this.fromTo(d,a,b,c)},pause:function(){this.ispause=!0,this.state="stop"},stop:function(){clearInterval(this.timer),this.state="stop",this.plusNum=0,this.plusCount=0,this.ispause=!1,this.recordFrom=0,this.recordTo=this.imgsLen-1,this.recordInf=this.options.loop,d(this,this.options.cover)},play:function(a){"play"!==this.state&&(this.ispause?this.ispause=!1:this.fromTo(this.recordFrom,this.recordTo,this.recordInf,a))},destroy:function(){clearInterval(this.timer),this.timer=null,this.ctx=null,this.canvas.remove(),this.canvas=null;for(var a in this)delete this[a]}},"function"==typeof define&&define.amd&&define([],function(){return a}),"undefined"!=typeof exports&&(exports.CanvasKeyFrames=a),"undefined"!=typeof window&&(window.CanvasKeyFrames=a)}();