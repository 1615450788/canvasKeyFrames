/*
 * canvas-keyframes.js v1.0.0
 * (c) 2019 wenyi
 * Released under the MIT license
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CanvasKeyFrames=t()}(this,function(){"use strict";var r={el:null,mode:"array",direction:"normal",fps:30,imgs:null,loop:!0,autoplay:!1,cover:0,process:0,framesLenth:0,ispause:!0,state:"stop",start:0,end:0,remaining:0,completed:!1,update:null,begin:null,complete:null,repeat:!1,repeatDirec:!0},o={arr:function(e){return Array.isArray(e)},obj:function(e){return stringContains(Object.prototype.toString.call(e),"Object")},pth:function(e){return o.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||o.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return o.hex(e)||o.rgb(e)||o.hsl(e)},key:function(e){return!defaultInstanceSettings.hasOwnProperty(e)&&!defaultTweenSettings.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function i(e){var t={};for(var n in e)t[n]=e[n];return t}var m,a=0;function h(e){var t=function(e,t){var n=i(e);for(var r in e)n[r]=t.hasOwnProperty(r)?t[r]:e[r];return n}(r,e),n=a;return a++,function(e,t){var n=i(e);for(var r in t)n[r]=o.und(e[r])?t[r]:e[r];return n}(t,{id:n})}var g=null,v=function(){function t(){m=requestAnimationFrame(e)}function e(e){g.ispause?m=cancelAnimationFrame(m):(g.tick(e),t())}return t}();function e(e,t,n,r){if(void 0===r&&(r={}),!e||!t)throw new Error("el和imgs是必填参数");if("array"!==n&&"sprite"!==n)throw new Error('只支持"array"和"sprite"模式');var o=0,i=Date.now(),a=0;"array"===n?r.framesLenth=t.length:(r.spriteArray=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});for(var n=e.width,r=e.height,o=t.w,i=t.h,a=n/o,s=r/i,c=[],p=0;p<s;p++)for(var u=0;u<a;u++)c.push({x:o*u,y:i*p});return c}({width:t.width,width:t.height},{w:r._iw,h:r._ih}),r.framesLenth=r.spriteArray.length),r.el=e,r.mode=n,r.imgs=t,r.start=0,r.end=r.framesLenth-1,r.remaining=r.framesLenth;var s=h(r),c=1e3/s.fps;!function(e){var t=document.createElement("canvas");t.width=e.width*window.devicePixelRatio||e.el.clientWidth,t.height=e.height*window.devicePixelRatio||e.el.clientHeight,t.style.display="block",t.style.width="100%",t.style.height="100%",e.ctx=t.getContext("2d"),e.el.appendChild(t),e.canvas=t}(s);var p,u;p=s,u=window.Promise&&new Promise(function(e){return e}),p.finished=u;function l(){var e=s.process;if(s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height),"array"===s.mode)0!==s.imgs[e].width&&s.ctx.drawImage(s.imgs[e],0,0,s.canvas.width,s.canvas.height);else{if("sprite"!==s.mode)throw new Error("没有匹配的模式");if(s.options.framesCount)s.ctx.drawImage(s.imgs,s.spriteArray[e].x,s.spriteArray[e].y,s._iw,s._ih,0,0,s.canvas.width,s.canvas.height);else{var t=s.imgs.width/s.imgsLen;s.ctx.drawImage(s.imgs,t*e,0,t,s.imgs.height,0,0,s.canvas.width,s.canvas.height)}}}function f(){o=0,i=Date.now(),a=0}function d(){if(s.begin||(s.begin=!0,s.ispause=!1,console.log(s.process,"aaa",s.start),s.process="normal"===s.direction?s.start-1:s.start+1,console.log("动态",s.process)),console.log("???????????"),s.remaining&&s.remaining--,s.remaining)"normal"===s.direction?s.process=s.process>=s.end?s.start:s.process+1:s.process=s.process<=0?s.start:s.process-1;else{if(s.ispause=!0,!s.completed){if(s.completed=!0,s.repeat)if(s.repeatDirec=!s.repeatDirec,s.repeatDirec){if(s.direction="normal"===s.direction?"alternate":"normal","normal"===s.direction){var e=s.start,t=s.end;t<e&&(s.start=t,s.end=e)}}else s.direction="alternate"===s.direction?"normal":"alternate";!function(e){s[e]&&s[e](s)}("complete")}s.loop?(s.completed=!1,s.remaining=Math.abs(s.end-s.start)+1,s.repeat?s.repeatDirec?s.process=s.start:s.process=s.end:s.process=s.start):("normal"===s.direction?s.process=s.process>=s.end?s.start:s.process+1:s.process=s.process<=0?s.start:s.process-1,s.pause())}console.log("打印instance.process=>",s.process)}return s.tick=function(e){o=Date.now(),c<(a=o-i)&&!s.ispause&&(i=o-a%c,console.log("enter",s.process),d(),l())},s.goto=function(e){s.process=e,l()},s.next=function(){var e=s.process+1>=s.framesLenth?0:s.process+1;s.goto(e)},s.prev=function(){var e=s.process-1<=0?s.framesLenth-1:s.process-1;s.goto(e)},s.fromTo=function(e){void 0===e&&(e={});var t=e.from,n=e.to,r=e.loop,o=e.complete;s.loop=r,s.complete=o,t<=n?(s.direction="normal",s.repeatDirec=!0,s.start=-1<t?t:0,s.end=n<s.framesLenth?n:s.framesLenth-1):(s.direction="alternate",s.repeatDirec=!1,s.start=t<s.framesLenth?t:s.framesLenth-1,s.end=-1<n?n:0),s.remaining=Math.abs(s.end-s.start)+1,s.process=s.start,s.play()},s.repeatloop=function(e){void 0===e&&(e={}),s.repeat=!0,s.fromTo(e)},s.pause=function(){m=cancelAnimationFrame(m),f(),s.ispause=!0,s.state="stop",l()},s.stop=function(){m=cancelAnimationFrame(m),f(),s.begin=!1,s.state="stop",s.ispause=!0,s.process=0,l()},s.play=function(){s.ispause&&(s.ispause=!1,g=s,m||v())},s.destroy=function(){for(var e in s.ctx=null,s.canvas.remove(),s.canvas=null,s.ispause=!0,m=cancelAnimationFrame(m),f(),s)delete s[e]},l(),s.autoplay&&s.play(),s}return e.version="1.0.0",e.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e});